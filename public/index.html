<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Backoffice Oggetti</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; }
        h2 { margin-top: 40px; }
        form { margin-bottom: 20px; }
        input, select, button { padding: 5px; margin: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table, th, td { border: 1px solid #ccc; }
        th, td { padding: 5px; text-align: left; }
    </style>
</head>
<body>
<p><a href="/logout">Logout</a></p>

<h1>Backoffice Oggetti</h1>

<!-- AREA -->
<h2>Gestione Aree</h2>
<form id="formArea">
    <input type="text" id="nomeArea" placeholder="Nome area" required>
    <button type="submit">Aggiungi Area</button>
</form>
<ul id="listaAree"></ul>

<!-- TIPO -->
<h2>Gestione Tipologie</h2>
<form id="formTipo">
    <input type="text" id="nomeTipo" placeholder="Nome tipologia" required>
    <button type="submit">Aggiungi Tipologia</button>
</form>
<ul id="listaTipi"></ul>

<!-- OGGETTO -->
<h2>Gestione Oggetti</h2>
<form id="formOggetto">
    <input type="text" id="nomeOggetto" placeholder="Nome oggetto" required>
    <select id="areaOggetto" required></select>
    <select id="tipoOggetto" required></select>
    <button type="submit">Aggiungi Oggetto</button>
</form>
<table>
    <thead>
        <tr>
            <th>Nome</th>
            <th>Area</th>
            <th>Tipologia</th>
        </tr>
    </thead>
    <tbody id="listaOggetti"></tbody>
</table>

<script>
const API = window.location.origin;

// --- AREE ---
async function caricaAree() {
    const res = await fetch(`${API}/aree`);
    const aree = await res.json();
    document.getElementById('listaAree').innerHTML = aree.map(a => `<li>${a.nome}</li>`).join('');
    document.getElementById('areaOggetto').innerHTML = aree.map(a => `<option value="${a.id}">${a.nome}</option>`).join('');
}

document.getElementById('formArea').addEventListener('submit', async e => {
    e.preventDefault();
    await fetch(`${API}/aree`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ nome: document.getElementById('nomeArea').value })
    });
    document.getElementById('nomeArea').value = '';
    caricaAree();
});

// --- TIPI ---
async function caricaTipi() {
    const res = await fetch(`${API}/tipi`);
    const tipi = await res.json();
    document.getElementById('listaTipi').innerHTML = tipi.map(t => `<li>${t.nome}</li>`).join('');
    document.getElementById('tipoOggetto').innerHTML = tipi.map(t => `<option value="${t.id}">${t.nome}</option>`).join('');
}

document.getElementById('formTipo').addEventListener('submit', async e => {
    e.preventDefault();
    await fetch(`${API}/tipi`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ nome: document.getElementById('nomeTipo').value })
    });
    document.getElementById('nomeTipo').value = '';
    caricaTipi();
});

// --- OGGETTI ---
async function caricaOggetti() {
    const res = await fetch(`${API}/oggetti`);
    const oggetti = await res.json();
    document.getElementById('listaOggetti').innerHTML = oggetti.map(o => `
        <tr>
            <td>${o.nome}</td>
            <td>${o.Area?.nome || ''}</td>
            <td>${o.Tipo?.nome || ''}</td>
        </tr>
    `).join('');
}

document.getElementById('formOggetto').addEventListener('submit', async e => {
    e.preventDefault();
    await fetch(`${API}/oggetti`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            nome: document.getElementById('nomeOggetto').value,
            areaId: document.getElementById('areaOggetto').value,
            tipoId: document.getElementById('tipoOggetto').value
        })
    });
    document.getElementById('nomeOggetto').value = '';
    caricaOggetti();
});

// --- INIT ---
caricaAree();
caricaTipi();
caricaOggetti();
</script>

</body>
</html>